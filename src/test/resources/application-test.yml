spring:
  application:
    name: budgetbuddy-backend-test
  
  # Enable bean definition overriding for tests
  main:
    allow-bean-definition-overriding: true
  
  # Test Database Configuration
  dynamodb:
    endpoint: http://localhost:4566 # LocalStack endpoint for testing
    region: us-east-1

# Test Application Configuration
app:
  name: BudgetBuddy Backend Test
  version: 1.0.0-test
  
  aws:
    region: us-east-1
    dynamodb:
      table-prefix: TestBudgetBuddy
      endpoint: http://localhost:4566
      auto-create-tables: false # Disable table auto-creation in tests
    s3:
      bucket-name: test-budgetbuddy-storage
    cloudwatch:
      enabled: false # Disable CloudWatch in tests
    appconfig:
      enabled: false # Disable AppConfig in tests to avoid AWS region requirement
  
  jwt:
    # JWT secret must be at least 64 characters (512 bits) for HS512 algorithm
    secret: test-jwt-secret-key-for-testing-only-must-be-at-least-64-characters-long-for-hs512-algorithm
    expiration: 3600000 # 1 hour for tests
    refresh-expiration: 86400000 # 1 day for tests
  
  plaid:
    client-id: test-client-id
    secret: test-secret
    environment: sandbox
  
  rate-limit:
    enabled: false # Disabled for tests to avoid rate limiting issues
    requests-per-minute: 100000 # Very high limit if enabled
    requests-per-hour: 1000000
    # Per-endpoint limits (used if rate limiting is enabled)
    auth-login: 50000
    auth-signup: 50000
    plaid: 100000
    transactions: 100000
    analytics: 100000
    default: 100000
    # DDoS protection limits
    ddos:
      max-requests-per-minute: 100000
      max-requests-per-hour: 1000000
  # 404 Error Tracking Configuration (lower thresholds for tests)
  ddos:
    notfound:
      max-per-minute: 20  # Lower threshold for tests (tests expect ~25 to exceed)
      max-per-hour: 100   # Lower threshold for tests (tests expect ~105 to exceed)
  
  security:
    cors:
      allowed-origins: "*" # Allow all in tests
    certificate-pinning:
      enabled: false # Disable in tests
    tls:
      min-version: TLSv1.2
      enabled-protocols: TLSv1.2,TLSv1.3

# Resilience4j Circuit Breaker Configuration for Tests
resilience4j:
  circuitbreaker:
    configs:
      default:
        failureRateThreshold: 50
        waitDurationInOpenState: 10s
        slidingWindowSize: 10
        minimumNumberOfCalls: 5
        permittedNumberOfCallsInHalfOpenState: 3
        automaticTransitionFromOpenToHalfOpenEnabled: true
    instances:
      plaid:
        failureRateThreshold: 70
        waitDurationInOpenState: 30s
        slidingWindowSize: 30
        minimumNumberOfCalls: 15
        permittedNumberOfCallsInHalfOpenState: 5
        automaticTransitionFromOpenToHalfOpenEnabled: true

# Logging
logging:
  level:
    root: INFO
    com.budgetbuddy: DEBUG
    org.springframework: WARN
    software.amazon.awssdk: WARN
